<div class="row">
  <div class="col-12">
    <div class="box bg-success"></div> Contondant (15 minutes)
    <div class="box bg-warning"></div> Léthal (2 jours)
    <div class="box bg-danger"></div> Aggravé (1 semaine)
  </div>
</div>

<div class="row">
  <div class="col-sm-3 col-xs-12" *ngFor="let player of players | async">
    <button type="button" class="btn btn-primary" (click)="togglePlayer(player)" *ngIf="isAdmin()">{{ player.displayed ? 'Cacher' : 'Afficher' }} {{ player.name }}</button>
    <div class="card" *ngIf="player.displayed">
      <h2 class="text-center">
        {{ player.name }}
        <ng-container *ngIf="player.ownerUrl && hasAccessToSheet(player)">
          (<a [attr.href]="'https://raphaelyan.github.io/rpg-digital-tools/nwod/mage/' + player.ownerUrl" target="_blank">lien</a>)
        </ng-container>
      </h2>

      <div class="col-12 text-center">Santé</div>
      <div class="col-12 boxes">
        <div class="box {{ box }}" *ngFor="let box of player.health; let i = index; let last = last" (click)="openModal(player, player.health, i)">

          <div class="health_malus" *ngIf="last">
            <span>-1</span>
            <span>-2</span>
            <span *ngIf="!player.steel_vigor">-3</span>
          </div>

        </div>
      </div>

      <div class="col-12 text-center">Volonté</div>
      <div class="col-12 boxes">
        <div class="box {{ box }}" *ngFor="let box of player.willpower; let i = index" (click)="toggleBox(player, player.willpower, i)">
        </div>
      </div>

      <ng-container *ngIf="player.mana">
        <div class="col-12 text-center">Mana</div>
        <div class="col-12 boxes">
          <div class="box {{ box }}" *ngFor="let box of player.mana; let i = index" (click)="toggleBox(player, player.mana, i)">
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="player.destinee">
        <div class="col-12 text-center">Destinée</div>
        <div class="col-12 boxes">
          <div class="box {{ box }}" *ngFor="let box of player.destinee; let i = index" (click)="toggleBox(player, player.destinee, i)">
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="player.bonus">
        <div class="col-12 text-center">Bonus</div>
        <ul>
          <li *ngFor="let bonus of player.bonus">{{ bonus }}</li>
        </ul>
      </ng-container>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-6" [class.offset-3]="!isAdmin()">
    <h2>Notes du DM</h2>
    <div class="notes" [innerHtml]="(text | async)?.text"></div>
  </div>
  <textarea *ngIf="isAdmin()" class="col-6" rows="5" [ngModel]="currentText" (ngModelChange)="updateText($event)">
  </textarea>
</div>

<div class="row">
  <div class="col-sm-3 col-xs-12" *ngFor="let player of players | async; let i = index" [hidden]="!player.displayed">
    <h2>Notes de {{ player.name }}</h2>
    <div class="notes" [innerHtml]="player.text"></div>
  </div>
</div>
<div class="row">
  <textarea *ngIf="staticData[0] && staticData[0].displayed && hasAccessToSheet(staticData[0])" class="col-12" rows="5" [(ngModel)]="staticData[0].text" (ngModelChange)="updatePlayerText(staticData[0], $event)">
  </textarea>
  <textarea *ngIf="staticData[1] && staticData[1].displayed && hasAccessToSheet(staticData[1])" class="col-12" rows="5" [(ngModel)]="staticData[1].text" (ngModelChange)="updatePlayerText(staticData[1], $event)">
  </textarea>
  <textarea *ngIf="staticData[2] && staticData[2].displayed && hasAccessToSheet(staticData[2])" class="col-12" rows="5" [(ngModel)]="staticData[2].text" (ngModelChange)="updatePlayerText(staticData[2], $event)">
  </textarea>
  <textarea *ngIf="staticData[3] && staticData[3].displayed && hasAccessToSheet(staticData[3])" class="col-12" rows="5" [(ngModel)]="staticData[3].text" (ngModelChange)="updatePlayerText(staticData[3], $event)">
  </textarea>
  <textarea *ngIf="staticData[4] && hasAccessToSheet(staticData[4])" class="col-12" rows="5" [(ngModel)]="staticData[4].text" (ngModelChange)="updatePlayerText(staticData[4], $event)">
  </textarea>
  <textarea *ngIf="staticData[5] && hasAccessToSheet(staticData[5])" class="col-12" rows="5" [(ngModel)]="staticData[5].text" (ngModelChange)="updatePlayerText(staticData[5], $event)">
  </textarea>
  <textarea *ngIf="staticData[6] && hasAccessToSheet(staticData[6])" class="col-12" rows="5" [(ngModel)]="staticData[6].text" (ngModelChange)="updatePlayerText(staticData[6], $event)">
  </textarea>
  <textarea *ngIf="staticData[7] && hasAccessToSheet(staticData[7])" class="col-12" rows="5" [(ngModel)]="staticData[7].text" (ngModelChange)="updatePlayerText(staticData[7], $event)">
  </textarea>
</div>

<div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Modifier la case</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="setBox('')">Vider</button>
        <button type="button" class="btn btn-success" (click)="setBox('bg-success')">Contondant</button>
        <button type="button" class="btn btn-warning" (click)="setBox('bg-warning')">Léthal</button>
        <button type="button" class="btn btn-danger" (click)="setBox('bg-danger')">Aggravé</button>
      </div>
    </div>
  </div>
</div>
